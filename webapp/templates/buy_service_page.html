{% extends "base.html" %}

{% block title %} Ø®Ø±ÛŒØ¯ Ùˆ ØªÙ…Ø¯ÛŒØ¯ Ø³Ø±ÙˆÛŒØ³ {% endblock %}

{% block extra_css %}
<style>
    .plan-price {
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--accent-color);
        margin-top: 1rem;
        margin-bottom: 1.5rem;
        text-align: center;
    }
    .plan-price small {
        font-size: 0.9rem;
        font-weight: normal;
        color: var(--text-secondary);
    }
    
    .panel-header {
        justify-content: center !important;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    .panel-header .fi {
        font-size: 1.5rem;
    }

    .smart-analysis-section {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius);
        padding: 1.5rem 2rem;
        margin-bottom: 2.5rem;
        box-shadow: 0 10px 25px -5px var(--shadow-color);
    }
    .smart-analysis-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        font-size: 1.3rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }
    .smart-analysis-header i {
        color: var(--accent-color);
        font-size: 1.8rem;
    }
    .smart-analysis-description {
        font-size: 0.95rem;
        color: var(--text-secondary);
        margin-bottom: 2rem;
        padding-right: 2.8rem;
    }
    .analysis-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        align-items: center;
    }
    .current-stats-panel {
        background: var(--bg-color);
        border-radius: var(--border-radius);
        padding: 1.5rem;
    }
    .current-stats-panel h5 {
        margin-top: 0;
        margin-bottom: 1.5rem;
        text-align: center;
        font-size: 1rem;
        font-weight: 500;
    }
    .stat-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.8rem 0;
    }
    .stat-row:not(:last-child) {
        border-bottom: 1px dashed var(--border-color);
    }
    .stat-row .label { font-size: 0.9rem; color: var(--text-secondary); }
    .stat-row .value { font-size: 1.1rem; font-weight: 700; }
    .recommendation-panel .info-card {
        border: 2px dashed var(--accent-color);
        background: linear-gradient(135deg, rgba(var(--accent-rgb), .05), transparent);
    }
    @media (max-width: 767px) {
        .analysis-content { grid-template-columns: 1fr; }
    }

    .faq-item {
        background-color: var(--card-bg); border: 1px solid var(--border-color);
        border-radius: var(--border-radius); margin-bottom: 1rem; overflow: hidden;
    }
    .faq-question {
        display: flex; justify-content: space-between; align-items: center;
        padding: 1.25rem 1.5rem; cursor: pointer; font-weight: 600;
    }
    .faq-question i { transition: transform 0.3s ease; }
    .faq-item.active .faq-question i { transform: rotate(180deg); }
    .faq-answer { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out; }
    .faq-answer p { padding: 0 1.5rem 1.25rem; margin-top: 0; color: var(--text-secondary); line-height: 1.8; }
</style>
{% endblock %}

{% block page_content %}
    {% set page_title='Ø®Ø±ÛŒØ¯ Ùˆ ØªÙ…Ø¯ÛŒØ¯ Ø³Ø±ÙˆÛŒØ³' %}
    {% include 'partials/_header.html' %}

    <section class="smart-analysis-section">
        <div class="smart-analysis-header">
            <i class="ri-line-chart-line"></i>
            <span>Ø¢Ù†Ø§Ù„ÛŒØ² Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø³Ø±ÙˆÛŒØ³ Ø´Ù…Ø§</span>
        </div>
        <p class="smart-analysis-description">Ø¯Ø± Ø§ÛŒÙ† Ø¨Ø®Ø´ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ Ø³Ø±ÙˆÛŒØ³ Ø®ÙˆØ¯ Ø±Ø§ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ø±Ø¯Ù‡ Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…ØµØ±Ù ÙˆØ§Ù‚Ø¹ÛŒâ€ŒØªØ§Ù†ØŒ Ø¨Ù‡ØªØ±ÛŒÙ† Ù¾Ù„Ù† Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø¯ÙˆØ±Ù‡ Ø¨Ø¹Ø¯ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.</p>

        <div class="analysis-content">
            <div class="current-stats-panel">
                <h5>Ø¢Ù…Ø§Ø± Ø³Ø±ÙˆÛŒØ³ ÙØ¹Ù„ÛŒ</h5>
                <div class="stat-row">
                    <span class="label">Ø±ÙˆØ² Ø¨Ø§Ù‚ÛŒÙ…Ø§Ù†Ø¯Ù‡</span>
                    <span class="value">{{ user.expire if user.expire is not none else 'âˆ' }}</span>
                </div>
                <div class="stat-row">
                    <span class="label">Ø­Ø¬Ù… Ù…ØµØ±Ù Ø´Ø¯Ù‡</span>
                    <span class="value">{{ "%.1f"|format(user.current_usage_GB) }} <small>GB</small></span>
                </div>
                <div class="stat-row">
                    <span class="label">Ø­Ø¬Ù… Ú©Ù„ Ø³Ø±ÙˆÛŒØ³</span>
                    <span class="value">{{ "%.1f"|format(user.usage_limit_GB) if user.usage_limit_GB > 0 else 'âˆ' }} <small>GB</small></span>
                </div>
            </div>
            
            <div class="recommendation-panel">
            {% if recommended_plan %}
                <div class="info-card panel-card">
                    <div class="panel-header" style="justify-content: center; padding-bottom: 0.5rem; margin-bottom: 1rem; border-bottom: 1px solid var(--border-color);">
                        <h4 style="color: var(--accent-color); font-weight: bold;">Ù¾Ù„Ù† Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ Ù…Ø§</h4>
                    </div>
                     <p style="font-size: 0.85rem; text-align: center; color: var(--text-secondary); margin-top:-0.5rem; margin-bottom: 1.5rem;">Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…ØµØ±Ù <b>{{ "%.1f"|format(actual_last_30_days_usage) }} Ú¯ÛŒÚ¯Ø§Ø¨Ø§ÛŒØªÛŒ</b> Ø´Ù…Ø§ Ø¯Ø± Ø§ÛŒÙ† Ø¯ÙˆØ±Ù‡</p>
                    
                    <ul class="server-stats" style="margin-top: 0;">
                        <li><div class="stat-label"><span>Ù†Ø§Ù… Ù¾Ù„Ù†</span></div><span class="stat-value">{{ recommended_plan.name }}</span></li>
                        
                        {% if recommended_plan.total_volume %}<li><div class="stat-label"><i class="ri-database-2-line"></i><span>Ø­Ø¬Ù… Ú©Ù„</span></div><span class="stat-value">{{ recommended_plan.total_volume }}</span></li>{% endif %}
                        {% if recommended_plan.volume_de %}<li><div class="stat-label"><span>Ø­Ø¬Ù… <span class="fi fi-de"></span></span></div><span class="stat-value">{{ recommended_plan.volume_de }}</span></li>{% endif %}
                        {% if recommended_plan.volume_fr %}<li><div class="stat-label"><span>Ø­Ø¬Ù… <span class="fi fi-fr"></span><span class="fi fi-tr"></span><span class="fi fi-us"></span></span></div><span class="stat-value">{{ recommended_plan.volume_fr }}</span></li>{% endif %}

                        {% if recommended_plan.duration %}<li><div class="stat-label"><i class="ri-time-line"></i><span>Ù…Ø¯Øª Ø²Ù…Ø§Ù†</span></div><span class="stat-value">{{ recommended_plan.duration }}</span></li>{% endif %}
                    </ul>

                    <div class="plan-price" style="margin-top: 0.5rem;">{{ "{:,.0f}".format(recommended_plan.price) }} <small>ØªÙˆÙ…Ø§Ù†</small></div>
                    <a href="{{ support_link }}" class="btn-action full-width-btn" target="_blank">Ù…Ø´Ø§ÙˆØ±Ù‡ Ùˆ Ø®Ø±ÛŒØ¯ Ø§ÛŒÙ† Ù¾Ù„Ù†</a>
                </div>
            {% else %}
                <div style="text-align: center; color: var(--text-secondary); padding: 1rem 0;">
                    <i class="ri-information-line" style="font-size: 2rem; display: block; margin-bottom: 0.5rem;"></i>
                    Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù‡ÙˆØ´Ù…Ù†Ø¯ØŒ Ø­Ø¯Ø§Ù‚Ù„ Ø¨Ø§ÛŒØ¯ Ù…Ù‚Ø¯Ø§Ø±ÛŒ Ù…ØµØ±Ù Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯.
                </div>
            {% endif %}
            </div>
        </div>
    </section>

    <h3 class="section-title">ğŸš€ Ù¾Ù„Ù†â€ŒÙ‡Ø§ÛŒ ØªØ±Ú©ÛŒØ¨ÛŒ (Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ)</h3>
    <section class="details-grid">
        {% for plan in combined_plans %}
        <div class="info-card panel-card">
            <div class="panel-header"><h4>{{ plan.name.replace('ğŸ¥‰', '').replace('ğŸ¥ˆ', '').replace('ğŸ¥‡', '').replace('âœ¨', '').replace('ğŸ’', '') }} {% if 'ğŸ¥‰' in plan.name %}ğŸ¥‰{% elif 'ğŸ¥ˆ' in plan.name %}ğŸ¥ˆ{% elif 'ğŸ¥‡' in plan.name %}ğŸ¥‡{% elif 'âœ¨' in plan.name %}âœ¨{% elif 'ğŸ’' in plan.name %}ğŸ’{% endif %}</h4></div>
            <ul class="server-stats">
                {% if plan.total_volume %}<li><div class="stat-label"><i class="ri-database-2-line"></i><span>Ø­Ø¬Ù… Ú©Ù„</span></div><span class="stat-value">{{ plan.total_volume }}</span></li>{% endif %}
                {% if plan.volume_de %}<li><div class="stat-label"><span>Ø­Ø¬Ù… <span class="fi fi-de"></span></span></div><span class="stat-value">{{ plan.volume_de }}</span></li>{% endif %}
                {% if plan.volume_fr %}<li><div class="stat-label"><span>Ø­Ø¬Ù… <span class="fi fi-fr"></span><span class="fi fi-tr"></span><span class="fi fi-us"></span></span></div><span class="stat-value">{{ plan.volume_fr }}</span></li>{% endif %}
                {% if plan.duration %}<li><div class="stat-label"><i class="ri-time-line"></i><span>Ù…Ø¯Øª Ø²Ù…Ø§Ù†</span></div><span class="stat-value">{{ plan.duration }}</span></li>{% endif %}
            </ul>
            <div class="plan-price">{{ "{:,.0f}".format(plan.price) }} <small>ØªÙˆÙ…Ø§Ù†</small></div>
            <a href="{{ support_link }}" class="btn-action full-width-btn" target="_blank">Ø®Ø±ÛŒØ¯ Ùˆ Ù…Ø´Ø§ÙˆØ±Ù‡</a>
        </div>
        {% else %}
            <p>Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ù¾Ù„Ù† ØªØ±Ú©ÛŒØ¨ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</p>
        {% endfor %}
    </section>
    
    <h3 class="section-title">Ù¾Ù„Ù†â€ŒÙ‡Ø§ÛŒ Ø§Ø®ØªØµØ§ØµÛŒ</h3>
    <section class="details-grid">
        {% for plan in dedicated_plans %}
        <div class="info-card panel-card">
            {# --- START: Ú©Ø¯ Ù†Ù‡Ø§ÛŒÛŒ Ùˆ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù¾Ø±Ú†Ù… Ø¯Ø± Ù¾Ù„Ù†â€ŒÙ‡Ø§ÛŒ Ø§Ø®ØªØµØ§ØµÛŒ --- #}
            <div class="panel-header">
                <h4>{{ plan.name | replace(' DE ', '') | replace(' FR ', '') | replace(' TR ', '') | replace(' US ', '') | replace('ğŸ‡©ğŸ‡ª', '') | replace('ğŸ‡«ğŸ‡·', '') | replace('ğŸ‡¹ğŸ‡·', '') | replace('ğŸ‡ºğŸ‡¸', '') }}</h4>
                {% if 'DE' in plan.name %}<span class="fi fi-de"></span>
                {% elif 'FR' in plan.name %}<span class="fi fi-fr"></span>
                {% elif 'TR' in plan.name %}<span class="fi fi-tr"></span>
                {% elif 'US' in plan.name %}<span class="fi fi-us"></span>
                {% endif %}
            </div>
            {# --- END: Ú©Ø¯ Ù†Ù‡Ø§ÛŒÛŒ Ùˆ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ --- #}
            <ul class="server-stats">
                <li><div class="stat-label"><i class="ri-database-2-line"></i><span>Ø­Ø¬Ù…</span></div><span class="stat-value">{{ plan.volume_de or plan.volume_fr or plan.volume_tr or plan.volume_us }}</span></li>
                <li><div class="stat-label"><i class="ri-time-line"></i><span>Ù…Ø¯Øª Ø²Ù…Ø§Ù†</span></div><span class="stat-value">{{ plan.duration }}</span></li>
            </ul>
            <div class="plan-price">{{ "{:,.0f}".format(plan.price) }} <small>ØªÙˆÙ…Ø§Ù†</small></div>
            <a href="{{ support_link }}" class="btn-action full-width-btn" target="_blank">Ø®Ø±ÛŒØ¯ Ùˆ Ù…Ø´Ø§ÙˆØ±Ù‡</a>
        </div>
        {% else %}
            <p>Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ù¾Ù„Ù† Ø§Ø®ØªØµØ§ØµÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</p>
        {% endfor %}
    </section>

    <div class="faq-container" style="margin-top: 3rem;">
        <h3 class="section-title" style="text-align: center;">Ø³ÙˆØ§Ù„Ø§Øª Ù…ØªØ¯Ø§ÙˆÙ„</h3>
        <div class="faq-item">
            <div class="faq-question"><span>ØªÙØ§ÙˆØª Ù¾Ù„Ù†â€ŒÙ‡Ø§ÛŒ ØªØ±Ú©ÛŒØ¨ÛŒ Ùˆ Ø§Ø®ØªØµØ§ØµÛŒ Ú†ÛŒØ³ØªØŸ</span><i class="ri-arrow-down-s-line"></i></div>
            <div class="faq-answer"><p>Ù¾Ù„Ù†â€ŒÙ‡Ø§ÛŒ <strong>ØªØ±Ú©ÛŒØ¨ÛŒ</strong> Ø¨Ù‡ Ø´Ù…Ø§ Ø§Ø² Ú†Ù†Ø¯ÛŒÙ† Ø³Ø±ÙˆØ± (Ø¢Ù„Ù…Ø§Ù†ØŒ ÙØ±Ø§Ù†Ø³Ù‡ØŒ ØªØ±Ú©ÛŒÙ‡ØŒ Ø¢Ù…Ø±ÛŒÚ©Ø§) Ø­Ø¬Ù… Ù…ÛŒâ€ŒØ¯Ù‡Ù†Ø¯ Ú©Ù‡ Ø¨Ø±Ø§ÛŒ Ø§Ù†Ø¹Ø·Ø§Ùâ€ŒÙ¾Ø°ÛŒØ±ÛŒ Ø¨ÛŒØ´ØªØ± Ø¹Ø§Ù„ÛŒ Ø§Ø³Øª. Ù¾Ù„Ù†â€ŒÙ‡Ø§ÛŒ <strong>Ø§Ø®ØªØµØ§ØµÛŒ</strong> ÙÙ‚Ø· Ø±ÙˆÛŒ ÛŒÚ© Ø³Ø±ÙˆØ± ØªÙ…Ø±Ú©Ø² Ø¯Ø§Ø±Ù†Ø¯ Ùˆ Ù…Ø¹Ù…ÙˆÙ„Ø§ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†ÛŒ Ù…Ù†Ø§Ø³Ø¨ Ù‡Ø³ØªÙ†Ø¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ¯Ø§Ù†Ù†Ø¯ Ú©Ø¯Ø§Ù… Ú©Ø´ÙˆØ± Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ†ØªØ±Ù†Øª Ø¢Ù†â€ŒÙ‡Ø§ Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ Ø¨Ù‡ØªØ±ÛŒ Ø¯Ø§Ø±Ø¯.</p></div>
        </div>
        <div class="faq-item">
            <div class="faq-question"><span>Ú†Ø·ÙˆØ± Ø¨Ù‡ØªØ±ÛŒÙ† Ù¾Ù„Ù† Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†Ù…ØŸ</span><i class="ri-arrow-down-s-line"></i></div>
            <div class="faq-answer"><p>Ú©Ø§Ø±Øª <strong>Ø¢Ù†Ø§Ù„ÛŒØ² Ø³Ø±ÙˆÛŒØ³</strong> Ø¯Ø± Ø¨Ø§Ù„Ø§ÛŒ Ù‡Ù…ÛŒÙ† ØµÙØ­Ù‡ Ø¨Ù‡ØªØ±ÛŒÙ† Ø±Ø§Ù‡Ù†Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§Ø³Øª. Ø§ÛŒÙ† Ú©Ø§Ø±Øª Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…ØµØ±Ù ÙˆØ§Ù‚Ø¹ÛŒ Ø´Ù…Ø§ØŒ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØªØ±ÛŒÙ† Ù¾Ù„Ù† Ø±Ø§ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯. Ø§Ú¯Ø± Ù‡Ù… Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù…Ø´Ø§ÙˆØ±Ù‡ Ø¯Ø§Ø±ÛŒØ¯ØŒ Ù‡Ù…ÛŒØ´Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² Ø·Ø±ÛŒÙ‚ Ø¯Ú©Ù…Ù‡ "Ø®Ø±ÛŒØ¯ Ùˆ Ù…Ø´Ø§ÙˆØ±Ù‡" Ø¨Ø§ Ù…Ø§ Ø¯Ø± ØªÙ…Ø§Ø³ Ø¨Ø§Ø´ÛŒØ¯.</p></div>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
{{ super() }}
<script>
document.addEventListener('DOMContentLoaded', () => {
    const faqItems = document.querySelectorAll('.faq-item');
    faqItems.forEach(item => {
        const question = item.querySelector('.faq-question');
        question.addEventListener('click', () => {
            const answer = item.querySelector('.faq-answer');
            const isActive = item.classList.contains('active');
            
            faqItems.forEach(otherItem => {
                if (otherItem !== item) {
                    otherItem.classList.remove('active');
                    otherItem.querySelector('.faq-answer').style.maxHeight = null;
                }
            });

            if (isActive) {
                item.classList.remove('active');
                answer.style.maxHeight = null;
            } else {
                item.classList.add('active');
                answer.style.maxHeight = answer.scrollHeight + 'px';
            }
        });
    });
});
</script>
{% endblock %}